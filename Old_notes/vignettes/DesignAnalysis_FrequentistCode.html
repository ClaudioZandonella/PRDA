<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Anna Vesely" />

<meta name="date" content="2019-12-04" />

<title>Design Analysis - Frequentist Code</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Design Analysis - Frequentist Code</h1>
<h4 class="author">Anna Vesely</h4>
<h4 class="date">2019-12-04</h4>



<!-- \VignetteEngine{knitr::rmarkdown} -->
<div id="cohens-d" class="section level2">
<h2>Cohen’s d</h2>
<p>Given the vectors <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> with the observed values of two groups, the function <tt><code>cohen_d</code></tt> computes Cohen’s <span class="math inline">\(d\)</span> effect size statistic with the corresponding t-statistic and p-value:</p>
<p><span class="math display">\[
d=\frac{\bar{\mathbf{x}_1}-\bar{\mathbf{x}_2}}{s_{\text{pool}}},\quad\quad t=d\,\sqrt{\frac{n_1\, n_2}{n_1+n_2}},\quad\quad p=2\,P(T_{r}\geq |t|)
\]</span></p>
<p>where <span class="math inline">\(T\)</span> follows a Student’s t-distribution with <span class="math inline">\(r=n_1+n_2-2\)</span> degrees of freedom.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">cohen_d &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2) {</a>
<a class="sourceLine" id="cb1-2" title="2">  </a>
<a class="sourceLine" id="cb1-3" title="3">  (m1 &lt;-<span class="st"> </span><span class="kw">mean</span>(x1, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-4" title="4">  (m2 &lt;-<span class="st"> </span><span class="kw">mean</span>(x2, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-5" title="5">  S1 &lt;-<span class="st"> </span><span class="kw">sum</span>((x1 <span class="op">-</span><span class="st"> </span>m1)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-6" title="6">  S2 &lt;-<span class="st"> </span><span class="kw">sum</span>((x2 <span class="op">-</span><span class="st"> </span>m2)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-7" title="7">  (n1 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">na.omit</span>(x1)))</a>
<a class="sourceLine" id="cb1-8" title="8">  (n2 &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">na.omit</span>(x2)))</a>
<a class="sourceLine" id="cb1-9" title="9">  (df &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2 <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-10" title="10">  </a>
<a class="sourceLine" id="cb1-11" title="11">  (pool.s &lt;-<span class="st"> </span><span class="kw">sqrt</span>((S1 <span class="op">+</span><span class="st"> </span>S2) <span class="op">/</span><span class="st"> </span>df))</a>
<a class="sourceLine" id="cb1-12" title="12">  (d &lt;-<span class="st"> </span>(m2 <span class="op">-</span><span class="st"> </span>m1) <span class="op">/</span><span class="st"> </span>pool.s)</a>
<a class="sourceLine" id="cb1-13" title="13">  </a>
<a class="sourceLine" id="cb1-14" title="14">  s1 &lt;-<span class="st"> </span><span class="kw">sd</span>(x1, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">  s2 &lt;-<span class="st"> </span><span class="kw">sd</span>(x2, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-16" title="16">  (tstat &lt;-<span class="st"> </span>(m2 <span class="op">-</span><span class="st"> </span>m1) <span class="op">/</span><span class="st"> </span>(pool.s <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((n1 <span class="op">+</span><span class="st"> </span>n2) <span class="op">/</span><span class="st"> </span>(n1 <span class="op">*</span><span class="st"> </span>n2))))</a>
<a class="sourceLine" id="cb1-17" title="17">  (pval &lt;-<span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), df, <span class="dt">lower.tail=</span><span class="ot">FALSE</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-18" title="18">  </a>
<a class="sourceLine" id="cb1-19" title="19">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">d=</span>d, <span class="dt">tstat=</span>tstat, <span class="dt">pval=</span>pval))</a>
<a class="sourceLine" id="cb1-20" title="20">}</a></code></pre></div>
</div>
<div id="design-analysis-given-a-plausible-value-of-d" class="section level2">
<h2>Design Analysis Given a Plausible Value of d</h2>
<div id="simulations-of-expected-power-and-errors" class="section level3">
<h3>Simulations of Expected Power and Errors</h3>
<p>In the comparison between two groups, given a plausible effect size <span class="math inline">\(d_{\text{sim}}\)</span>, the sample sizes <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> of the groups and the significance level <span class="math inline">\(\alpha\)</span>, the function <tt><code>sim\_estimate</code></tt> computes the expected power <span class="math inline">\(\beta\)</span>, the type S error <span class="math inline">\(e_S\)</span> (the risk that a significant effect is estimated in the wrong direction) and the type M error <span class="math inline">\(e_M\)</span> (the average overestimation of an effect that emerges as significant).</p>
<p>In particular, the function simulates <span class="math inline">\(\mathbf{x}_1\)</span> as <span class="math inline">\(n_1\)</span> observations from a <span class="math inline">\(\mathcal{N}(0,1)\)</span> distribution, and <span class="math inline">\(\mathbf{x}_2\)</span> as <span class="math inline">\(n_2\)</span> observations from a <span class="math inline">\(\mathcal{N}(d_{\text{sim}},1)\)</span> distribution. Then the values of Cohen’s <span class="math inline">\(d\)</span> and the corresponding test statistic <span class="math inline">\(t\)</span> and p-value <span class="math inline">\(p\)</span> are estimated. Such procedure is repeated <span class="math inline">\(B\)</span> times (default <span class="math inline">\(10^4\)</span>), and leads to:</p>
<p><span class="math display">\[\begin{align*}
\hat{\beta}=\frac{\#\{i\,:\,p_i&lt;\alpha\}}{B},\quad\quad \hat{e}_S=\frac{\#\{i\,:\,p_i&lt;\alpha,\;t_i&lt;0\}}{\#\{i\,:\,p_i&lt;\alpha\}},\quad\quad \hat{e}_M=\frac{\text{mean}\{|d_i|\,:\,p_i&lt;\alpha\}}{d_{\text{sim}}}.
\end{align*}\]</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">sim_estimate &lt;-<span class="st"> </span><span class="cf">function</span>(sim_d, <span class="dt">target_d=</span>sim_d, n1, <span class="dt">n2=</span>n1,</a>
<a class="sourceLine" id="cb2-2" title="2">                          <span class="dt">sig.level=</span><span class="fl">0.05</span>, <span class="dt">B=</span><span class="fl">1e4</span> ) {</a>
<a class="sourceLine" id="cb2-3" title="3">  outsim &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">replicate</span>(B, {</a>
<a class="sourceLine" id="cb2-4" title="4">    x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n1)</a>
<a class="sourceLine" id="cb2-5" title="5">    x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n2, sim_d)</a>
<a class="sourceLine" id="cb2-6" title="6">    d &lt;-<span class="st"> </span><span class="kw">cohen_d</span>(x1, x2)</a>
<a class="sourceLine" id="cb2-7" title="7">    sim &lt;-<span class="st"> </span><span class="kw">c</span>(d<span class="op">$</span>d, d<span class="op">$</span>tstat, d<span class="op">$</span>pval, sim_d)</a>
<a class="sourceLine" id="cb2-8" title="8">  }))</a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="kw">colnames</span>(outsim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;est_d&quot;</span>, <span class="st">&quot;tstat&quot;</span>, <span class="st">&quot;pval&quot;</span>, <span class="st">&quot;sim_d&quot;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">  (outsim &lt;-<span class="st"> </span><span class="kw">data.frame</span>(outsim))</a>
<a class="sourceLine" id="cb2-11" title="11">  (outsim<span class="op">$</span>power &lt;-<span class="st"> </span><span class="kw">sum</span>(outsim<span class="op">$</span>pval <span class="op">&lt;</span><span class="st"> </span>sig.level) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(outsim))</a>
<a class="sourceLine" id="cb2-12" title="12">  (outsim<span class="op">$</span>typeS &lt;-<span class="st"> </span><span class="kw">with</span>(outsim,</a>
<a class="sourceLine" id="cb2-13" title="13">                        <span class="kw">sum</span>((pval <span class="op">&lt;</span><span class="st"> </span>sig.level) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="st">                               </span>(tstat <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(pval <span class="op">&lt;</span><span class="st"> </span>sig.level)))</a>
<a class="sourceLine" id="cb2-15" title="15">  (outsim<span class="op">$</span>typeM &lt;-<span class="st"> </span><span class="kw">with</span>(outsim,</a>
<a class="sourceLine" id="cb2-16" title="16">                        <span class="kw">mean</span>(<span class="kw">abs</span>(est_d[pval <span class="op">&lt;</span><span class="st"> </span>sig.level]))) <span class="op">/</span><span class="st"> </span>target_d)</a>
<a class="sourceLine" id="cb2-17" title="17">  <span class="kw">return</span>(outsim)</a>
<a class="sourceLine" id="cb2-18" title="18">}</a></code></pre></div>
</div>
<div id="prospective-analysis-from-power-to-sample-size" class="section level3">
<h3>Prospective Analysis: from Power to Sample Size</h3>
<p>In the comparison between two groups, given a plausible value of effect size <span class="math inline">\(d_{\text{sim}}\)</span>, the significance level <span class="math inline">\(\alpha\)</span> and the required power <span class="math inline">\(\beta\)</span>, the function  estimates the sample size per group <span class="math inline">\(n\)</span> needed to reach such power, as well as the type S error <span class="math inline">\(e_S\)</span> and the type M error <span class="math inline">\(e_M\)</span>. The function also requires the minimum and the maximum size values (<span class="math inline">\(n_{\min}\)</span> and <span class="math inline">\(n_{\max}\)</span>), the number <span class="math inline">\(B\)</span> of iterations and a tolerance <span class="math inline">\(\epsilon\)</span>.</p>
<p>Firstly, the function evaluates <span class="math inline">\(\hat{\beta}_{\max}\)</span>, the expected power given the effect size <span class="math inline">\(d_{\text{sim}}\)</span> and the sample sizes <span class="math inline">\(n_1=n_2=n_{\max}\)</span>. If <span class="math inline">\(\hat{\beta}_{\max}&lt;\beta\)</span>, the function stops, because a bigger value <span class="math inline">\(n_{\max}\)</span> is needed.</p>
<p>Otherwise, let <span class="math inline">\((l^{(1)},\, u^{(1)})=(n_{\min},\, n_{\max})\)</span>. For each step <span class="math inline">\(j=1,2,\ldots\)</span>, the function defines <span class="math display">\[\hat{n}^{(j)}=\lfloor\text{median}\{l^{(j)},\,l^{(j)}+1,\,\ldots,\, u^{(j)}\}\rfloor ,\]</span> and <span class="math inline">\(\hat{\beta}^{(j)}\)</span> as the expected power given the effect size <span class="math inline">\(d_{\text{sim}}\)</span> and the sample sizes <span class="math inline">\(n_1=n_2=\hat{n}^{(j)}\)</span>.</p>
<ul>
<li>If <span class="math inline">\(\hat{\beta}^{(j)}\in (\beta-\epsilon,\,\beta+\epsilon]\)</span>, then the value <span class="math inline">\(\hat{n}^{(j)}\)</span> is returned.</li>
<li>Otherwise, if <span class="math inline">\(\hat{\beta}^{(j)}&gt;\beta + \epsilon\)</span>, then <span class="math inline">\((l^{(j+1)},\, u^{(j+1)}) =(l^{(j)},\,\hat{n}^{(j)})\)</span>.</li>
<li>Otherwise, if <span class="math inline">\(\hat{\beta}^{(j)}\leq \beta - \epsilon\)</span>, then <span class="math inline">\((l^{(j+1)},\, u^{(j+1)}) =(\hat{n}^{(j)},\, u^{(j)})\)</span>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">design_analysis_n &lt;-<span class="st"> </span><span class="cf">function</span>(d, power, <span class="dt">sig.level=</span><span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">                               <span class="dt">rangen=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1000</span>), <span class="dt">B=</span><span class="fl">1e4</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">                               <span class="dt">tol=</span><span class="fl">0.005</span> ){</a>
<a class="sourceLine" id="cb3-4" title="4">  </a>
<a class="sourceLine" id="cb3-5" title="5">  (n_seq &lt;-<span class="st"> </span><span class="kw">seq</span>(rangen[<span class="dv">1</span>], rangen[<span class="dv">2</span>], <span class="dt">by=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb3-6" title="6">  (n_target &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">median</span>(n_seq)))</a>
<a class="sourceLine" id="cb3-7" title="7">  find_power &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-8" title="8">  </a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="co">## check with maximum N</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">cat</span>(<span class="st">&quot;Estimating power with n =&quot;</span>, rangen[<span class="dv">2</span>], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb3-11" title="11">  (est_P &lt;-<span class="st"> </span><span class="kw">sim_estimate</span>(<span class="dt">n1=</span>rangen[<span class="dv">2</span>], <span class="dt">n2=</span>rangen[<span class="dv">2</span>], <span class="dt">sim_d=</span>d,</a>
<a class="sourceLine" id="cb3-12" title="12">                          <span class="dt">target_d=</span>d, <span class="dt">sig.level=</span>sig.level, <span class="dt">B=</span>B))</a>
<a class="sourceLine" id="cb3-13" title="13">  (est_power &lt;-<span class="st"> </span>est_P[<span class="dv">1</span>,]<span class="op">$</span>power)</a>
<a class="sourceLine" id="cb3-14" title="14">  </a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="cf">if</span> (est_power <span class="op">&lt;</span><span class="st"> </span>power) {</a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Actual power = &quot;</span>, est_power, <span class="st">&quot; with n=&quot;</span>, rangen[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb3-17" title="17">               <span class="st">&quot; (per group); &quot;</span> ), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot; try to increase maximum of rangen &gt; &quot;</span>, rangen[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb3-19" title="19">               <span class="st">&quot;.&quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb3-20" title="20">    out &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb3-21" title="21">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-22" title="22">    </a>
<a class="sourceLine" id="cb3-23" title="23">    <span class="co">## estimating power</span></a>
<a class="sourceLine" id="cb3-24" title="24">    <span class="cf">while</span>((<span class="op">!</span>find_power)) {</a>
<a class="sourceLine" id="cb3-25" title="25">      <span class="kw">cat</span>(<span class="st">&quot;Estimating power with n=&quot;</span>, n_target, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb3-26" title="26">      (est_P &lt;-<span class="st"> </span><span class="kw">sim_estimate</span>(<span class="dt">n1=</span>n_target, <span class="dt">n2=</span>n_target, <span class="dt">sim_d=</span>d,</a>
<a class="sourceLine" id="cb3-27" title="27">                              <span class="dt">target_d=</span>d, <span class="dt">sig.level=</span>sig.level, <span class="dt">B=</span>B))</a>
<a class="sourceLine" id="cb3-28" title="28">      (est_power &lt;-<span class="st"> </span>est_P[<span class="dv">1</span>,]<span class="op">$</span>power)</a>
<a class="sourceLine" id="cb3-29" title="29">      </a>
<a class="sourceLine" id="cb3-30" title="30">      <span class="cf">if</span> ((est_power <span class="op">&lt;=</span><span class="st"> </span>(power <span class="op">+</span><span class="st"> </span>tol)) <span class="op">&amp;</span><span class="st"> </span>(est_power <span class="op">&gt;</span><span class="st"> </span>(power <span class="op">-</span><span class="st"> </span>tol))) {</a>
<a class="sourceLine" id="cb3-31" title="31">        find_power &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb3-32" title="32">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-33" title="33">        </a>
<a class="sourceLine" id="cb3-34" title="34">        <span class="cf">if</span> (<span class="kw">length</span>(n_seq)<span class="op">==</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb3-35" title="35">          <span class="kw">print</span>(n_seq)</a>
<a class="sourceLine" id="cb3-36" title="36">          <span class="kw">stop</span>(<span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb3-37" title="37">        }</a>
<a class="sourceLine" id="cb3-38" title="38">        </a>
<a class="sourceLine" id="cb3-39" title="39">        <span class="cf">if</span> (est_power <span class="op">&gt;</span><span class="st"> </span>(power <span class="op">-</span><span class="st"> </span>tol)) {</a>
<a class="sourceLine" id="cb3-40" title="40">          (n_seq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(n_seq), n_target, <span class="dt">by=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb3-41" title="41">          (n_target &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">median</span>(n_seq)))</a>
<a class="sourceLine" id="cb3-42" title="42">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-43" title="43">          (n_seq &lt;-<span class="st"> </span><span class="kw">seq</span>(n_target, <span class="kw">max</span>(n_seq), <span class="dt">by=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb3-44" title="44">          (n_target &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">median</span>(n_seq)))</a>
<a class="sourceLine" id="cb3-45" title="45">        }</a>
<a class="sourceLine" id="cb3-46" title="46">      }</a>
<a class="sourceLine" id="cb3-47" title="47">    }</a>
<a class="sourceLine" id="cb3-48" title="48">    out &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">d=</span>d, <span class="dt">power=</span>power, <span class="dt">n=</span>n_target,</a>
<a class="sourceLine" id="cb3-49" title="49">                 <span class="dt">typeS=</span>est_P[<span class="dv">1</span>,<span class="st">&quot;typeS&quot;</span>], <span class="dt">typeM=</span>est_P[<span class="dv">1</span>,<span class="st">&quot;typeM&quot;</span>])</a>
<a class="sourceLine" id="cb3-50" title="50">  }</a>
<a class="sourceLine" id="cb3-51" title="51">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(out)) <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb3-52" title="52">}</a></code></pre></div>
</div>
<div id="retrospective-analysis-from-sample-size-to-power" class="section level3">
<h3>Retrospective Analysis: from Sample Size to Power</h3>
<p>In the comparison between two groups, given a plausible value of effect size <span class="math inline">\(d_{\text{sim}}\)</span>, the significance level <span class="math inline">\(\alpha\)</span> and the sample size per group <span class="math inline">\(n\)</span>, the function  estimates the power <span class="math inline">\(\beta\)</span>, the type S error <span class="math inline">\(e_S\)</span> and the type M error <span class="math inline">\(e_M\)</span>. It makes use of the function .</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">design_analysis_power &lt;-<span class="st"> </span><span class="cf">function</span>(n, d, <span class="dt">sig.level=</span><span class="fl">0.05</span>, <span class="dt">B=</span><span class="fl">1e4</span>,</a>
<a class="sourceLine" id="cb4-2" title="2">                                   <span class="dt">tol=</span><span class="fl">0.005</span>) {</a>
<a class="sourceLine" id="cb4-3" title="3">  out &lt;-<span class="st"> </span><span class="kw">sim_estimate</span>(<span class="dt">sim_d=</span>d, <span class="dt">target_d=</span>d, <span class="dt">n1=</span>n, <span class="dt">sig.level=</span>sig.level,</a>
<a class="sourceLine" id="cb4-4" title="4">                      <span class="dt">B=</span>B)</a>
<a class="sourceLine" id="cb4-5" title="5">  out=<span class="kw">list</span>(<span class="dt">d=</span>d, <span class="dt">n=</span>n, <span class="dt">power=</span>out[<span class="dv">1</span>,<span class="st">&quot;power&quot;</span>], <span class="dt">typeS=</span>out[<span class="dv">1</span>,<span class="st">&quot;typeS&quot;</span>],</a>
<a class="sourceLine" id="cb4-6" title="6">           <span class="dt">typeM=</span>out[<span class="dv">1</span>,<span class="st">&quot;typeM&quot;</span>])</a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb4-8" title="8">}</a></code></pre></div>
</div>
<div id="prospective-or-retrospective-design-analysis" class="section level3">
<h3>Prospective or Retrospective Design Analysis</h3>
<p>In the comparison between two groups, given a plausible value of effect size <span class="math inline">\(d_{\text{sim}}\)</span> and the significance level <span class="math inline">\(\alpha\)</span>, the function  performs a design analysis.</p>
<ul>
<li>If the power <span class="math inline">\(\beta\)</span> is given, it uses the function  to estimate the sample size per group <span class="math inline">\(n\)</span> needed to reach that power, as well as the type S error <span class="math inline">\(e_S\)</span> and the type M error <span class="math inline">\(e_M\)</span>.</li>
<li>If the sample size per group <span class="math inline">\(n\)</span> is given, it uses the function  to estimate the power <span class="math inline">\(\beta\)</span>, the type S error <span class="math inline">\(e_S\)</span> and the type M error <span class="math inline">\(e_M\)</span>.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">design_analysis &lt;-<span class="st"> </span><span class="cf">function</span>(d, <span class="dt">n=</span><span class="ot">NULL</span>, <span class="dt">power=</span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb5-2" title="2">                             <span class="dt">sig.level=</span><span class="fl">0.05</span>, <span class="dt">B =</span><span class="fl">1e4</span>,</a>
<a class="sourceLine" id="cb5-3" title="3">                             <span class="dt">rangen=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1000</span>),  <span class="dt">tol=</span><span class="fl">0.005</span>) {</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="cf">if</span> (d <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="kw">stop</span>(<span class="st">&quot;A d greater than 0 must be entered&quot;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6">  }</a>
<a class="sourceLine" id="cb5-7" title="7">  </a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="cf">if</span> (<span class="kw">sum</span>(<span class="kw">sapply</span>(<span class="kw">list</span>(n, power), is.null)) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="kw">stop</span>(<span class="st">&quot;Exactly one of &#39;n&#39; or &#39;power&#39; must be NULL&quot;</span>)</a>
<a class="sourceLine" id="cb5-10" title="10">  }</a>
<a class="sourceLine" id="cb5-11" title="11">  </a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="cf">if</span> (<span class="kw">is.null</span>(n)) {</a>
<a class="sourceLine" id="cb5-13" title="13">    out &lt;-<span class="st"> </span><span class="kw">design_analysis_n</span>(<span class="dt">d=</span>d, <span class="dt">power=</span>power, <span class="dt">sig.level=</span>sig.level,</a>
<a class="sourceLine" id="cb5-14" title="14">                              <span class="dt">rangen=</span>rangen, <span class="dt">B=</span>B )</a>
<a class="sourceLine" id="cb5-15" title="15">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="cf">if</span> (<span class="kw">is.null</span>(power)) {</a>
<a class="sourceLine" id="cb5-17" title="17">      out &lt;-<span class="st"> </span><span class="kw">design_analysis_power</span>(<span class="dt">n=</span>n, <span class="dt">d=</span>d, <span class="dt">sig.level=</span>sig.level, <span class="dt">B=</span>B)</a>
<a class="sourceLine" id="cb5-18" title="18">    } </a>
<a class="sourceLine" id="cb5-19" title="19">  }</a>
<a class="sourceLine" id="cb5-20" title="20">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb5-21" title="21">}</a></code></pre></div>
</div>
</div>
<div id="design-analysis-given-a-plausible-distribution-for-d" class="section level2">
<h2>Design Analysis Given a Plausible Distribution for d</h2>
<div id="sampling-of-cohens-d" class="section level3">
<h3>Sampling of Cohen’s d</h3>
<p>The function  requires the package . It samples a vector <span class="math inline">\(\mathbf{d}\)</span> of <span class="math inline">\(B_0\)</span> values from a given distribution. Such distribution is bounded on an interval <span class="math inline">\((d_{\min},d_{\max})\)</span>, and may be</p>
<ul>
<li>uniform (default);</li>
<li>doubly truncated normal with mean and standard deviation <span class="math display">\[\mu_d=\frac{d_{\min}+d_{\max}}{2},\quad\quad\sigma_d=k\,(d_{\max}-d_{\min})\]</span> (where <span class="math inline">\(k\)</span> is a given constant).</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">sampling_d &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">target_limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb6-2" title="2">                        <span class="dt">distribution=</span><span class="kw">c</span>(<span class="st">&quot;uniform&quot;</span>, <span class="st">&quot;normal&quot;</span>), <span class="dt">k=</span><span class="dv">1</span><span class="op">/</span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb6-3" title="3">                        <span class="dt">B0=</span><span class="fl">1e4</span>) {</a>
<a class="sourceLine" id="cb6-4" title="4">  </a>
<a class="sourceLine" id="cb6-5" title="5">  distribution &lt;-<span class="st"> </span><span class="kw">match.arg</span>(distribution)</a>
<a class="sourceLine" id="cb6-6" title="6">  my &lt;-<span class="st"> </span>(<span class="kw">sum</span>(target_limits) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-7" title="7">  sy &lt;-<span class="st"> </span><span class="kw">diff</span>(target_limits) <span class="op">*</span><span class="st"> </span>k</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="cf">if</span> (distribution<span class="op">==</span><span class="st">&quot;uniform&quot;</span>) {</a>
<a class="sourceLine" id="cb6-9" title="9">    y &lt;-<span class="st"> </span><span class="kw">runif</span>(B0, target_limits[<span class="dv">1</span>], target_limits[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb6-10" title="10">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-11" title="11">    y &lt;-<span class="st"> </span><span class="kw">rtruncnorm</span>(B0, target_limits[<span class="dv">1</span>], target_limits[<span class="dv">2</span>], <span class="dt">mean=</span>my,</a>
<a class="sourceLine" id="cb6-12" title="12">                    <span class="dt">sd=</span>sy)</a>
<a class="sourceLine" id="cb6-13" title="13">    </a>
<a class="sourceLine" id="cb6-14" title="14">  }</a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">y=</span>y, <span class="dt">my=</span>my, <span class="dt">sy=</span>sy))</a>
<a class="sourceLine" id="cb6-16" title="16">}</a></code></pre></div>
</div>
<div id="extended-retrospective-design-analysis" class="section level3">
<h3>Extended Retrospective Design Analysis</h3>
<p>The function  requires the package . In the comparison between two groups, it performs a retrospective design analysis. In particular, given the sizes <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> of the two groups, a plausible effect size (either a fixed value or a distribution) and the significance level <span class="math inline">\(\alpha\)</span>, it estimates the power <span class="math inline">\(\beta\)</span>, the type S error <span class="math inline">\(e_S\)</span> and the type M error <span class="math inline">\(e_M\)</span>.</p>
<ul>
<li>If the plausible effect size is defined by a single value <span class="math inline">\(d_{\text{sim}}\)</span>, then <span class="math inline">\(\hat{\beta}\)</span>, <span class="math inline">\(\hat{e}_{S}\)</span> and <span class="math inline">\(\hat{e}_{M}\)</span> are computed through the function .</li>
<li>If the plausible effect size is defined by a bounded distribution, specified as in the function , then a vector <span class="math inline">\(\mathbf{d}\)</span> is sampled from such distribution. For each sampled value <span class="math inline">\(d_i\)</span>, the corresponding estimates <span class="math inline">\(\hat{\beta}_i\)</span>, <span class="math inline">\(\hat{e}_{S,i}\)</span> and <span class="math inline">\(\hat{e}_{M,i}\)</span> are computed. Finally, the means of these values are returned as <span class="math inline">\(\hat{\beta}\)</span>, <span class="math inline">\(\hat{e}_{S}\)</span> and <span class="math inline">\(\hat{e}_{M}\)</span>.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">design_est&lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n1=</span><span class="dv">5</span>, <span class="dt">n2=</span>n1, <span class="dt">target_d=</span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb7-2" title="2">                       <span class="dt">target_d_limits=</span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb7-3" title="3">                       <span class="dt">distribution=</span><span class="kw">c</span>(<span class="st">&quot;uniform&quot;</span>, <span class="st">&quot;normal&quot;</span>), <span class="dt">k=</span><span class="dv">1</span><span class="op">/</span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">                       <span class="dt">sig.level=</span><span class="fl">0.05</span>, <span class="dt">B=</span><span class="dv">500</span>, <span class="dt">B0=</span><span class="dv">500</span>,</a>
<a class="sourceLine" id="cb7-5" title="5">                       <span class="dt">return_data=</span><span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb7-6" title="6">  </a>
<a class="sourceLine" id="cb7-7" title="7">  distribution &lt;-<span class="st"> </span><span class="kw">match.arg</span>(distribution)</a>
<a class="sourceLine" id="cb7-8" title="8">  </a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="cf">if</span> (<span class="kw">sum</span>(<span class="kw">sapply</span>(<span class="kw">list</span>(target_d, target_d_limits), is.null)) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="kw">stop</span>(<span class="st">&quot;Exactly one of &#39;target_d&#39; and &#39;target_d_limits&#39; must be NULL&quot;</span>)</a>
<a class="sourceLine" id="cb7-11" title="11">  }</a>
<a class="sourceLine" id="cb7-12" title="12">  </a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="co">########### fixed d</span></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(target_d)) {</a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="cf">if</span> (target_d <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;Target_d must be greater than 0&quot;</span>)</a>
<a class="sourceLine" id="cb7-16" title="16">    temp &lt;-<span class="st"> </span><span class="kw">sim_estimate</span>(<span class="dt">sim_d=</span>target_d, <span class="dt">target_d=</span>target_d, <span class="dt">n1=</span>n1,</a>
<a class="sourceLine" id="cb7-17" title="17">                         <span class="dt">n2=</span>n2, <span class="dt">B=</span>B)</a>
<a class="sourceLine" id="cb7-18" title="18">    results &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">power=</span>temp[<span class="dv">1</span>,<span class="st">&quot;power&quot;</span>], <span class="dt">typeS=</span>temp[<span class="dv">1</span>,<span class="st">&quot;typeS&quot;</span>],</a>
<a class="sourceLine" id="cb7-19" title="19">                    <span class="dt">typeM=</span>temp[<span class="dv">1</span>,<span class="st">&quot;typeM&quot;</span>])</a>
<a class="sourceLine" id="cb7-20" title="20">    outList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">call=</span><span class="kw">list</span>(<span class="dt">n1=</span>n1, <span class="dt">n2=</span>n2, <span class="dt">target_d=</span>target_d, <span class="dt">B=</span>B),</a>
<a class="sourceLine" id="cb7-21" title="21">                    <span class="dt">results=</span>results)</a>
<a class="sourceLine" id="cb7-22" title="22">    <span class="kw">return</span>(outList)</a>
<a class="sourceLine" id="cb7-23" title="23">  }</a>
<a class="sourceLine" id="cb7-24" title="24">  </a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="co">############## plausible interval and distribution for d</span></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(target_d_limits)) {</a>
<a class="sourceLine" id="cb7-27" title="27">    <span class="cf">if</span> (<span class="kw">min</span>(target_d_limits)<span class="op">&lt;</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-28" title="28">      <span class="kw">stop</span>(<span class="st">&quot;Minimum of target_d_limits must be greater than 0&quot;</span>)</a>
<a class="sourceLine" id="cb7-29" title="29">    (call_est &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">n1=</span>n1, <span class="dt">n2=</span>n2, <span class="dt">target_d_limits=</span>target_d_limits,</a>
<a class="sourceLine" id="cb7-30" title="30">                      <span class="dt">distribution=</span>distribution, <span class="dt">k=</span>k, <span class="dt">B=</span>B, <span class="dt">B0=</span>B0))</a>
<a class="sourceLine" id="cb7-31" title="31">    (my &lt;-<span class="st"> </span>(<span class="kw">sum</span>(target_d_limits) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb7-32" title="32">    (sy &lt;-<span class="st"> </span><span class="kw">diff</span>(target_d_limits) <span class="op">*</span><span class="st"> </span>k)</a>
<a class="sourceLine" id="cb7-33" title="33">    y &lt;-<span class="st"> </span><span class="kw">sampling_d</span>(target_d_limits, <span class="dt">distribution=</span>distribution,</a>
<a class="sourceLine" id="cb7-34" title="34">                    <span class="dt">B0=</span>B0, <span class="dt">k=</span>k) <span class="co">###</span></a>
<a class="sourceLine" id="cb7-35" title="35">    sim_cohen &lt;-<span class="st"> </span>y<span class="op">$</span>y</a>
<a class="sourceLine" id="cb7-36" title="36"></a>
<a class="sourceLine" id="cb7-37" title="37">    </a>
<a class="sourceLine" id="cb7-38" title="38">    data &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>B0, <span class="cf">function</span>(b){</a>
<a class="sourceLine" id="cb7-39" title="39">      temp &lt;-<span class="st"> </span><span class="kw">sim_estimate</span>(sim_cohen[b], <span class="dt">target_d=</span>my, <span class="dt">n1=</span>n1, <span class="dt">n2=</span>n2,</a>
<a class="sourceLine" id="cb7-40" title="40">                           <span class="dt">B=</span>B)</a>
<a class="sourceLine" id="cb7-41" title="41">      <span class="kw">c</span>(temp[<span class="dv">1</span>,<span class="st">&quot;power&quot;</span>], temp[<span class="dv">1</span>,<span class="st">&quot;typeS&quot;</span>], temp[<span class="dv">1</span>,<span class="st">&quot;typeM&quot;</span>])</a>
<a class="sourceLine" id="cb7-42" title="42">    }))</a>
<a class="sourceLine" id="cb7-43" title="43">    data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(data)</a>
<a class="sourceLine" id="cb7-44" title="44">    <span class="kw">colnames</span>(data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;power&quot;</span>, <span class="st">&quot;typeS&quot;</span>, <span class="st">&quot;typeM&quot;</span>)</a>
<a class="sourceLine" id="cb7-45" title="45">    </a>
<a class="sourceLine" id="cb7-46" title="46">    (power &lt;-<span class="st"> </span><span class="kw">mean</span>(data<span class="op">$</span>power))</a>
<a class="sourceLine" id="cb7-47" title="47">    (typeS &lt;-<span class="st"> </span><span class="kw">mean</span>(data<span class="op">$</span>typeS, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-48" title="48">    (typeM &lt;-<span class="st"> </span><span class="kw">mean</span>(data<span class="op">$</span>typeM, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-49" title="49">    </a>
<a class="sourceLine" id="cb7-50" title="50">    results &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">power=</span>power, <span class="dt">typeS=</span>typeS, <span class="dt">typeM=</span>typeM)</a>
<a class="sourceLine" id="cb7-51" title="51">    <span class="cf">if</span> (return_data) {</a>
<a class="sourceLine" id="cb7-52" title="52">      results<span class="op">$</span>data &lt;-<span class="st"> </span>data</a>
<a class="sourceLine" id="cb7-53" title="53">      </a>
<a class="sourceLine" id="cb7-54" title="54">      outList &lt;-<span class="st">  </span><span class="kw">list</span>(<span class="dt">call=</span>call_est, <span class="dt">results=</span>results)</a>
<a class="sourceLine" id="cb7-55" title="55">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-56" title="56">      outList &lt;-<span class="st">  </span><span class="kw">list</span>(<span class="dt">call=</span>call_est, <span class="dt">results=</span>results)</a>
<a class="sourceLine" id="cb7-57" title="57">    }</a>
<a class="sourceLine" id="cb7-58" title="58">    <span class="kw">return</span>(outList)</a>
<a class="sourceLine" id="cb7-59" title="59">  }</a>
<a class="sourceLine" id="cb7-60" title="60">}</a></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
